<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Khách Sạn - SOA</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <script>
        // Auto redirect based on user role
        (function() {
            const token = localStorage.getItem('auth_token');
            if (token) {
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    const payload = JSON.parse(jsonPayload);
                    const roles = payload.roles || [];
                    
                    if (roles.includes('admin') || roles.includes('manager') || roles.includes('receptionist')) {
                        if (!window.location.pathname.includes('admin.html')) {
                            window.location.href = 'admin.html';
                        }
                    } else {
                        if (!window.location.pathname.includes('user.html') && !window.location.pathname.includes('admin.html')) {
                            window.location.href = 'user.html';
                        }
                    }
                } catch (e) {
                    // Invalid token, stay on current page
                }
            } else {
                // No token, redirect to user page
                if (window.location.pathname === '/' || window.location.pathname.includes('index.html')) {
                    window.location.href = 'user.html';
                }
            }
        })();
    </script>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-hotel"></i>
                <span>Quản Lý Khách Sạn</span>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </a>
                <a href="#" class="nav-link" data-page="customers">
                    <i class="fas fa-users"></i> Khách Hàng
                </a>
                <a href="#" class="nav-link" data-page="rooms">
                    <i class="fas fa-bed"></i> Phòng
                </a>
                <a href="#" class="nav-link" data-page="bookings">
                    <i class="fas fa-calendar-check"></i> Đặt Phòng
                </a>
                <a href="#" class="nav-link" data-page="payments">
                    <i class="fas fa-credit-card"></i> Thanh Toán
                </a>
                <a href="#" class="nav-link" data-page="reports">
                    <i class="fas fa-chart-bar"></i> Báo Cáo
                </a>
            </div>
            <div class="nav-auth">
                <span id="userInfo" class="user-info"></span>
                <button id="logoutBtn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Đăng Xuất
                </button>
                <button id="loginBtn" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Đăng Nhập
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Login Page -->
        <div id="loginPage" class="page active">
            <div class="login-container">
                <div class="login-card">
                    <h2><i class="fas fa-lock"></i> Đăng Nhập</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label>Username hoặc Email</label>
                            <input type="text" id="loginUsername" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-sign-in-alt"></i> Đăng Nhập
                        </button>
                    </form>
                    <p class="text-center">
                        Chưa có tài khoản? 
                        <a href="#" id="showRegister">Đăng ký ngay</a>
                    </p>
                    <div id="loginError" class="error-message"></div>
                </div>

                <div class="login-card" id="registerCard" style="display: none;">
                    <h2><i class="fas fa-user-plus"></i> Đăng Ký</h2>
                    <form id="registerForm">
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="regUsername" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="regEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Họ và Tên</label>
                            <input type="text" id="regFullName" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="regPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-user-plus"></i> Đăng Ký
                        </button>
                    </form>
                    <p class="text-center">
                        Đã có tài khoản? 
                        <a href="#" id="showLogin">Đăng nhập</a>
                    </p>
                    <div id="registerError" class="error-message"></div>
                </div>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: #4CAF50;">
                        <i class="fas fa-bed"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalRooms">-</h3>
                        <p>Tổng Phòng</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #2196F3;">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalBookings">-</h3>
                        <p>Tổng Đặt Phòng</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #FF9800;">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalRevenue">-</h3>
                        <p>Doanh Thu</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #9C27B0;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalCustomers">-</h3>
                        <p>Khách Hàng</p>
                    </div>
                </div>
            </div>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Doanh Thu Theo Thời Gian</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Trạng Thái Đặt Phòng</h3>
                    <canvas id="bookingStatusChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Customers Page -->
        <div id="customersPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-users"></i> Quản Lý Khách Hàng</h1>
                <button class="btn btn-primary" onclick="showCustomerModal()">
                    <i class="fas fa-plus"></i> Thêm Khách Hàng
                </button>
            </div>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="customerSearch" placeholder="Tìm kiếm theo tên, email, số điện thoại...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Họ Tên</th>
                            <th>Email</th>
                            <th>Số Điện Thoại</th>
                            <th>Địa Chỉ</th>
                            <th>Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody id="customersTableBody">
                        <tr>
                            <td colspan="6" class="text-center">Đang tải...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Rooms Page -->
        <div id="roomsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-bed"></i> Quản Lý Phòng</h1>
                <div>
                    <button class="btn btn-primary" onclick="showRoomTypeModal()">
                        <i class="fas fa-plus"></i> Thêm Loại Phòng
                    </button>
                    <button class="btn btn-primary" onclick="showRoomModal()">
                        <i class="fas fa-plus"></i> Thêm Phòng
                    </button>
                </div>
            </div>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="roomSearch" placeholder="Tìm kiếm phòng...">
                    <i class="fas fa-search"></i>
                </div>
                <select id="roomStatusFilter" class="filter-select">
                    <option value="">Tất cả trạng thái</option>
                    <option value="available">Có sẵn</option>
                    <option value="occupied">Đã thuê</option>
                    <option value="maintenance">Bảo trì</option>
                </select>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="showRoomTypes()">Loại Phòng</button>
                <button class="tab-btn" onclick="showRooms()">Danh Sách Phòng</button>
            </div>
            <div id="roomTypesSection" class="tab-content active">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên</th>
                                <th>Mô Tả</th>
                                <th>Giá/Đêm</th>
                                <th>Số Người</th>
                                <th>Tiện Ích</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody id="roomTypesTableBody">
                            <tr><td colspan="7" class="text-center">Đang tải...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="roomsSection" class="tab-content">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Số Phòng</th>
                                <th>Loại Phòng</th>
                                <th>Trạng Thái</th>
                                <th>Tầng</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody id="roomsTableBody">
                            <tr><td colspan="6" class="text-center">Đang tải...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Bookings Page -->
        <div id="bookingsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-calendar-check"></i> Quản Lý Đặt Phòng</h1>
                <button class="btn btn-primary" onclick="showBookingModal()">
                    <i class="fas fa-plus"></i> Đặt Phòng Mới
                </button>
            </div>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="bookingSearch" placeholder="Tìm kiếm đặt phòng...">
                    <i class="fas fa-search"></i>
                </div>
                <select id="bookingStatusFilter" class="filter-select">
                    <option value="">Tất cả trạng thái</option>
                    <option value="pending">Chờ xử lý</option>
                    <option value="confirmed">Đã xác nhận</option>
                    <option value="cancelled">Đã hủy</option>
                    <option value="completed">Hoàn thành</option>
                </select>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Khách Hàng</th>
                            <th>Phòng</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Số Người</th>
                            <th>Trạng Thái</th>
                            <th>Tổng Tiền</th>
                            <th>Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTableBody">
                        <tr><td colspan="9" class="text-center">Đang tải...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Payments Page -->
        <div id="paymentsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-credit-card"></i> Quản Lý Thanh Toán</h1>
                <button class="btn btn-primary" onclick="showPaymentModal()">
                    <i class="fas fa-plus"></i> Tạo Thanh Toán
                </button>
            </div>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="paymentSearch" placeholder="Tìm kiếm thanh toán...">
                    <i class="fas fa-search"></i>
                </div>
                <select id="paymentStatusFilter" class="filter-select">
                    <option value="">Tất cả trạng thái</option>
                    <option value="pending">Chờ xử lý</option>
                    <option value="completed">Hoàn thành</option>
                    <option value="failed">Thất bại</option>
                    <option value="refunded">Đã hoàn tiền</option>
                </select>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Mã Đặt Phòng</th>
                            <th>Số Tiền</th>
                            <th>Phương Thức</th>
                            <th>Trạng Thái</th>
                            <th>Mã Giao Dịch</th>
                            <th>Ngày Tạo</th>
                            <th>Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTableBody">
                        <tr><td colspan="8" class="text-center">Đang tải...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reportsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-chart-bar"></i> Báo Cáo và Thống Kê</h1>
            </div>
            <div class="reports-grid">
                <div class="report-card">
                    <h3>Báo Cáo Doanh Thu</h3>
                    <div class="report-filters">
                        <input type="date" id="revenueStartDate" class="form-control">
                        <input type="date" id="revenueEndDate" class="form-control">
                        <button class="btn btn-primary" onclick="loadRevenueReport()">
                            <i class="fas fa-search"></i> Xem Báo Cáo
                        </button>
                    </div>
                    <div id="revenueReportContent"></div>
                </div>
                <div class="report-card">
                    <h3>Thống Kê Đặt Phòng</h3>
                    <div id="bookingReportContent"></div>
                </div>
                <div class="report-card">
                    <h3>Thống Kê Phòng</h3>
                    <div id="roomReportContent"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeAllModals()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeAllModals()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/api.js"></script>
    <script src="js/jwt-utils.js"></script>
    <script src="js/router.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/rooms.js"></script>
    <script src="js/bookings.js"></script>
    <script src="js/payments.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/main.js"></script>
    <script src="js/utils.js"></script>
</body>
</html>

