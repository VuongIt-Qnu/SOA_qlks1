<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
    <link rel="stylesheet" href="/css/admin.css" />
    <script src="/js/payments.js" defer></script>
    <script src="/js/jwt-utils.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/utils.js"></script>
</head>
<body>
    <div id="adminLayout"></div>

    <main class="main">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="title" style="margin:0;">Payment Management</h2>
            <button onclick="showPaymentModal()" class="btn-save" style="width:auto; margin:0; padding:10px 25px;">
                <i class="fa-solid fa-plus"></i> Add Payment
            </button>
        </div>

        <div class="filter-bar">
            <input type="text" id="paymentSearch" class="filter-input" placeholder="Search by ID, Booking ID, Transaction ID..." style="flex: 2;">

            <select id="paymentStatusFilter" class="filter-input">
                <option value="">All Status</option>
                <option value="PENDING">Pending</option>
                <option value="PAID">Paid</option>
                <option value="FAILED">Failed</option>
                <option value="REFUNDED">Refunded</option>
            </select>

            <button onclick="applyPaymentFilters()" class="btn-save" style="width:auto; margin:0; padding:8px 20px; background:#4b7bec;">
                <i class="fa-solid fa-search"></i> Search
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th width="50">ID</th>
                        <th>Booking ID</th>
                        <th>Amount (VND)</th>
                        <th>Method</th>
                        <th>Status</th>
                        <th>Transaction ID</th>
                        <th>Date</th>
                        <th width="120">Actions</th>
                    </tr>
                </thead>
                <tbody id="paymentsTableBody">
                    <tr><td colspan="8" style="text-align:center">Loading payments...</td></tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-btn" onclick="closeModal()" style="position:absolute; top:15px; right:20px; cursor:pointer; font-size:24px;">&times;</span>
            <h2 id="paymentModalTitle" style="margin-top:0; color:#333;">Add Payment</h2>

            <form id="paymentForm">
                <input type="hidden" id="paymentId">

                <div class="form-group">
                    <label>Booking ID *</label>
                    <select id="paymentBookingId" class="form-control" required>
                        <option value="">Select Booking</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Amount (VND) *</label>
                    <input type="number" id="paymentAmount" class="form-control" required min="0" step="1000" placeholder="100000">
                </div>

                <div class="form-group">
                    <label>Payment Method *</label>
                    <select id="paymentMethod" class="form-control" required>
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="e_wallet">E-Wallet</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Transaction ID</label>
                    <input type="text" id="paymentTransactionId" class="form-control" placeholder="Optional transaction reference">
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="paymentNotes" class="form-control" rows="3" placeholder="Optional notes"></textarea>
                </div>

                <div class="form-group" style="text-align: right; margin-top: 20px;">
                    <button type="button" onclick="closeModal()" class="btn-cancel" style="margin-right: 10px;">Cancel</button>
                    <button type="submit" class="btn-save">Save Payment</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Load admin layout
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminLayout();
        });
    </script>
</body>
</html>